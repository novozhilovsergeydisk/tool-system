#!/bin/bash

# === Простой скрипт развертывания ===
# Использование: ./git-deploy "Ваш комментарий"

# === Настройки ===
PROJECT_DIR="$(pwd)"
LOGFILE="$PROJECT_DIR/deploy.log"

# === Цвета для вывода ===
GREEN='\033[32m'
BLUE='\033[34m'
YELLOW='\033[33m'
RED='\033[31m'
NC='\033[0m' # No Color

# === Логирование и вывод в терминал ===
log() {
  local level="$1"
  local message="$2"
  echo -e "$(date "+%Y-%m-%d %T") [$level] $message" | tee -a "$LOGFILE"
}

info() {
  echo -e "${BLUE}[*] $1${NC}" | tee -a "$LOGFILE"
}

success() {
  echo -e "${GREEN}[✓] $1${NC}" | tee -a "$LOGFILE"
}

warn() {
  echo -e "${YELLOW}[!] $1${NC}" | tee -a "$LOGFILE"
}

error() {
  echo -e "${RED}[✗] $1${NC}" | tee -a "$LOGFILE"
}

COMMENT="$1"

# === Начало работы ===
mkdir -p "$(dirname "$LOGFILE")"
log "INFO" "Развертывание проекта типа '$PROJECT_TYPE'"

# === Git операции ===
info "Добавляем изменения..."
git add .

info "Создаем коммит..."
if ! git commit -m "$COMMENT" 2>/dev/null; then
  warn "Нет изменений для коммита"
  exit 0
fi

info "Отправляем в репозиторий..."
git push

success "✅ Процесс обновления успешно завершен!"
