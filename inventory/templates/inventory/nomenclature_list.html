{% extends 'inventory/base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 mt-2">
    <h3>üìã –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã</h3>
    
    {% if user.is_staff %}
    <div>
        <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addModal">
            <i class="fa-solid fa-folder-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—É
        </button>
        <a href="{% url 'tool_add' %}" class="btn btn-success">
            <i class="fa-solid fa-box-open"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é
        </a>
    </div>
    {% endif %}
</div>

<div class="card shadow-sm">
    <div class="card-body p-0">
        <table class="table table-striped table-hover mb-0 align-middle">
            <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ê—Ä—Ç–∏–∫—É–ª</th>
                    <th>–¢–∏–ø</th>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    {% if user.is_staff %}<th style="width: 120px; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>{% endif %}
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td><strong>{{ item.name }}</strong></td>
                    <td><span class="text-muted">{{ item.article }}</span></td>
                    <td>
                        {% if item.item_type == 'TOOL' %}
                            <span class="badge bg-secondary">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</span>
                        {% else %}
                            <span class="badge bg-info text-dark">–†–∞—Å—Ö–æ–¥–Ω–∏–∫</span>
                        {% endif %}
                    </td>
                    <td class="text-muted small">{{ item.description|truncatechars:50 }}</td>
                    
                    {% if user.is_staff %}
                    <td align="center">
                        <div class="d-flex justify-content-center gap-1">
                            <a href="{% url 'nomenclature_edit' item.pk %}" class="btn btn-sm btn-outline-primary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                <i class="fa-solid fa-pencil"></i>
                            </a>

                            <form action="{% url 'nomenclature_delete' item.pk %}" method="post" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å {{ item.name }}? –í–Ω–∏–º–∞–Ω–∏–µ: —ç—Ç–æ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã!');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="addModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">–ù–æ–≤–∞—è –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ (–í–∏–¥)</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post">
                <div class="modal-body">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        {{ form.name }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ê—Ä—Ç–∏–∫—É–ª</label>
                        {{ form.article }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–¢–∏–ø</label>
                        {{ form.item_type }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        {{ form.description }}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}